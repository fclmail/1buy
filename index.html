<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>USDC Deposit (Android)</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@walletconnect/client@1.7.3/dist/index.min.js"></script>
</head>
<body>
    <h2>USDC Deposit</h2>
    <button onclick="connectWallet()">Connect Wallet</button>
    <p id="walletAddress">Wallet: Not connected</p>

    <label for="amount">Select amount:</label>
    <select id="amount">
        <option value="10000">0.01 USDC</option>
        <option value="1000000">1.0 USDC</option>
    </select>
    
    <button onclick="depositUSDC()">Deposit</button>

    <p id="status"></p>

    <script>
        let provider, signer, walletConnector;
        const usdcAddress = "0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174"; // USDC on Polygon
        const recipient = "0x7114a16E0a396b0B40ee139e8c14FDd3335348eA";

        async function connectWallet() {
            walletConnector = new WalletConnect.default({
                bridge: "https://bridge.walletconnect.org" // WalletConnect bridge server
            });

            if (!walletConnector.connected) {
                walletConnector.createSession().then(() => {
                    alert("Scan the QR code with your mobile wallet.");
                    walletConnector.on("connect", (error, payload) => {
                        if (error) return alert("Connection failed!");
                        provider = new ethers.providers.Web3Provider(walletConnector);
                        signer = provider.getSigner();
                        document.getElementById("walletAddress").innerText = "Wallet: " + payload.params[0].accounts[0];
                    });
                });
            } else {
                provider = new ethers.providers.Web3Provider(walletConnector);
                signer = provider.getSigner();
                document.getElementById("walletAddress").innerText = "Wallet: " + walletConnector.accounts[0];
            }
        }

        async function depositUSDC() {
            if (!signer) return alert("Please connect your wallet first!");

            const usdcContract = new ethers.Contract(
                usdcAddress,
                ["function transfer(address to, uint amount) public returns (bool)"],
                signer
            );

            const amount = document.getElementById("amount").value;

            try {
                document.getElementById("status").innerText = "Sending...";
                const tx = await usdcContract.transfer(recipient, amount);
                await tx.wait();
                document.getElementById("status").innerText = "Deposit Successful! Tx: " + tx.hash;
            } catch (error) {
                document.getElementById("status").innerText = "Error: " + error.message;
            }
        }
    </script>
</body>
</html>
